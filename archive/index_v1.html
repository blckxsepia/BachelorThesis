<head>
  <title>Active Breaker</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    property="og:image"
    content="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ftheme-builder-meta%20copy.png?1555366209261"
  />
  <!-- import Material Icons from Google Fonts -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:900i"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500"
    rel="stylesheet"
  />
  <!-- import the Material stylesheet -->
  <link rel="stylesheet" href="bundle.css" />
  <!-- Add favicons -->
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-32x32.png?1553712190412"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="96x96"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-96x96.png?1553712190613"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-16x16.png?1553712190383"
  />
</head>
<body class="mdc-typography">
  <header
    class="mdc-top-app-bar mdc-top-app-bar--fixed mdc-top-app-bar--fixed-scrolled"
  >
    <div class="mdc-top-app-bar__row">
      <section
        class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"
      >
        <a
          class="material-icons mdc-top-app-bar__navigation-icon mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
          style="--mdc-ripple-fg-size:14px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:5px; --mdc-ripple-top:5px;"
          >menu</a
        >
        <span class="mdc-top-app-bar__title">ActiveBreaker</span>
      </section>
      <section
        class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end"
        role="toolbar"
      >
        <a
          class="material-icons mdc-icon-button mdc-top-app-bar__action-item mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
          aria-label="Share"
          alt="Share"
          style="--mdc-ripple-fg-size:28px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:10px; --mdc-ripple-top:10px;"
          >share</a
        >
        <a
          class="material-icons mdc-icon-button mdc-top-app-bar__action-item mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
          aria-label="Bookmark this page"
          alt="Bookmark this page"
          style="--mdc-ripple-fg-size:28px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:10px; --mdc-ripple-top:10px;"
          >bookmark</a
        >
      </section>
    </div>
  </header>
  <div class="mdc-drawer__header">
    <h1>Back Mate</h1>
    <!--button--->

    <button class="mdc-button mdc-button--raised" onclick="init()">
      Start Cam
    </button>
    <button class="mdc-button mdc-button--raised" onclick="hide()">
      Stop Cam
    </button>
    <!--canvas-->
    <div id="TM">
    <div><canvas id="canvas"></canvas></div>
    <div id="label-container"></div>
    </div>
    <br />
    <footer>
    <ul>
      <li><a href="/index_preview.html">link to bootstrap doku</a></li>
      <li>
        <a href="https://www.tensorflow.org/guide">link to tensor flow </a>
      </li>
      <li>
        <a href="https://github.com/tensorflow/tfjs-models/tree/master/posenet"
          >pose net</a
        >
      </li>
      <li>
        <a
          href="https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/pose
"
          >google teachable maschine
        </a>
      </li>
    </ul>
    </footer>

    <br />
    <!--->Progressbar</--->
    <div id="progressBar">
      <div class="bar"></div>
    </div>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

    <script>
      function progress(timeleft, timetotal, $element) {
        var progressBarWidth = (timeleft * $element.width()) / timetotal;
        $element
          .find("div")
          .animate({ width: progressBarWidth }, 500)
          .html(Math.floor(timeleft / 60) + ":" + (timeleft % 60));
        if (timeleft > 0) {
          setTimeout(function() {
            progress(timeleft - 1, timetotal, $element);
          }, 1000);
        }
      }

      progress(500, 500, $("#progressBar"));
    </script>

    <!-- import the Material javascript file -->
    <script src="components.dll.js"></script>
    <script src="bundle.js"></script>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
<script type="text/javascript">
  // More API functions here:
  // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/pose

  // the link to your model provided by Teachable Machine export panel
  const URL = "https://teachablemachine.withgoogle.com/models/vxiow7xHt/";
  let model, webcam, ctx, labelContainer, maxPredictions;

  async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    // load the model and metadata
    // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
    // Note: the pose library adds a tmPose object to your window (window.tmPose)
    model = await tmPose.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    // Convenience function to setup a webcam
    const size = 200;
    const flip = true; // whether to flip the webcam
    webcam = new tmPose.Webcam(size, size, flip); // width, height, flip
    await webcam.setup(); // request access to the webcam
    await webcam.play();
    window.requestAnimationFrame(loop);

    // append/get elements to the DOM
    const canvas = document.getElementById("canvas");
    canvas.width = size;
    canvas.height = size;
    ctx = canvas.getContext("2d");
    labelContainer = document.getElementById("label-container");
    for (let i = 0; i < maxPredictions; i++) {
      // and class labels
      labelContainer.appendChild(document.createElement("div"));
    }
  }

  async function loop(timestamp) {
    webcam.update(); // update the webcam frame
    await predict();
    window.requestAnimationFrame(loop);
  }

  async function predict() {
    // Prediction #1: run input through posenet
    // estimatePose can take in an image, video or canvas html element
    const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
    // Prediction 2: run input through teachable machine classification model
    const prediction = await model.predict(posenetOutput);

    for (let i = 0; i < maxPredictions; i++) {
      const classPrediction =
        prediction[i].className + ": " + prediction[i].probability.toFixed(2);
      labelContainer.childNodes[i].innerHTML = classPrediction;
    }

    // finally draw the poses
    drawPose(pose);
  }

  function drawPose(pose) {
    if (webcam.canvas) {
      ctx.drawImage(webcam.canvas, 0, 0);
      // draw the keypoints and skeleton
      if (pose) {
        const minPartConfidence = 0.5;
        tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
        tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
      }
    }
  }
  function stopWatching() {
    webcam.stop();
  }

  function hide() {
    var x = document.getElementById("TM");
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }
  }
</script>
