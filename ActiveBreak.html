<head>
  <title>Active Breaker</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    property="og:image"
    content="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ftheme-builder-meta%20copy.png?1555366209261"
  />
  <!-- import Material Icons from Google Fonts -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:900i"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500"
    rel="stylesheet"
  />
  <!-- import the Material stylesheet -->
  <link rel="stylesheet" href="bundle.css" />
  <!-- Add favicons -->
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-32x32.png?1553712190412"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="96x96"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-96x96.png?1553712190613"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="https://cdn.glitch.com/9c389208-b279-4e96-bcbc-e5f8712d8706%2Ffavicon-16x16.png?1553712190383"
  />
  <!--- Notification ring--->
</head>

<body class="mdc-typography" onload="init()">
  <div class="main-content">
    <header>
      <div class="mdc-top-app-bar__row">
        <section
          class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"
        >
          <a
            class="material-icons mdc-top-app-bar__navigation-icon mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
            style="--mdc-ripple-fg-size:14px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:5px; --mdc-ripple-top:5px;"
            >menu</a
          >
          <span class="mdc-top-app-bar__title">ActiveBreaker</span>
        </section>
        <section
          class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end"
          role="toolbar"
        >
          <a
            class="material-icons mdc-icon-button mdc-top-app-bar__action-item mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
            aria-label="Share"
            alt="Share"
            style="--mdc-ripple-fg-size:28px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:10px; --mdc-ripple-top:10px;"
            >share</a
          >
          <a
            class="material-icons mdc-icon-button mdc-top-app-bar__action-item mdc-ripple-upgraded mdc-ripple-upgraded--unbounded"
            aria-label="Bookmark this page"
            alt="Bookmark this page"
            style="--mdc-ripple-fg-size:28px; --mdc-ripple-fg-scale:1.71429; --mdc-ripple-left:10px; --mdc-ripple-top:10px;"
            >bookmark</a
          >
        </section>
      </div>
    </header>

    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li>
          <a href="form.html">Settings</a>
        </li>
        <li><a href="ActiveBreak.html">Start Active Break</a></li>
        <li><a href="Work.html">Start Working</a></li>
        <li><a href="stats.html">Statistics</a></li>
      </ul>
    </nav>

    <main>
      <!--Ping-->
      <audio id="aud">
        <source
          src="https://cdn.glitch.com/344122ff-b96f-4b0e-b327-a5fea0abf4a7%2FA-Tone-His_Self-1266414414.mp3?v=1596449765553"
          type="audio/mpeg"
          id="bing"
        />
      </audio>
      <script>
        var aud = document.getElementById("aud");
        aud.load();
        aud.autoplay = true;
        aud.play();
      </script>

      <h1>ActiveBreaker</h1>
      <span id="dummy"></span>

      <!--button--->
      <!--->Progressbar</--->

      <div id="progressBar">
        <div class="bar"></div>
      </div>

      <script>
        //ProgressBar
        function progress(timeleft, timetotal, $element) {
          var x = document.getElementById("TM");
          var progressBarWidth = (timeleft * $element.width()) / timetotal;
          $element
            .find("div")
            .animate({ width: progressBarWidth }, 500)
            .html(Math.floor(timeleft / 60) + ":" + (timeleft % 60));
          if (timeleft > 0 && x.style.display == "block") {
            setTimeout(function() {
              progress(timeleft - 1, timetotal, $element);
            }, 1000);
          } else {
            setTimeout(function() {
              progress(timeleft, timetotal, $element);
            }, 1000);
          }
        }
      </script>

      <!-- trainer -->
      <script>
        
      </script>
      <div id="trainer">
        <div id="exercises">
          <div id="exercise">
        </div>
          <div id="label">
          </div>
      </div>
      <script>
        var exercises = [
            {
              exerciseName: "Raised Arms",
              alt: "Raised Arms",
              url:
                "https://cdn.glitch.com/344122ff-b96f-4b0e-b327-a5fea0abf4a7%2Fgif_raised_arms.gif?v=1596619843770"
            },
            {
              exerciseName: "Squad",
              alt: "Squad",
              url:
                "https://cdn.glitch.com/344122ff-b96f-4b0e-b327-a5fea0abf4a7%2Fgif_squats_red.gif?v=1596619838934"
            },
            {
              exerciseName: "March",
              alt: "March",
              url:
                "https://cdn.glitch.com/344122ff-b96f-4b0e-b327-a5fea0abf4a7%2Fgif-march-red.gif?v=1596619836208"
            }
          ];
            

        function drawExercise() {
          exercises.forEach(function(exercises) {
            var img = document.createElement("img");
            var p = document.createElement("p");
            img.src = exercises.url;
            img.alt = exercises.alt;
            p.innerHTML = exercises.exerciseName;
            exercise.appendChild(img);
            exercise.appendChild(p);
          });

        }
      </script>

      <!--canvas-->
      <div id="TM">
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <div><canvas id="canvas"></canvas></div>
        <div id="label-container"></div>
      </div>
      <br />
      <button type="mdc-button" onclick="history.back()">Back</button>

      <button
        class="mdc-button mdc-button--raised"
        onclick="window.location.href = 'ActiveBreak.html';"
      >
        <span class="material-icons">
          skip_previous
        </span>
      </button>
      <button class="mdc-button mdc-button--raised" onclick="start()">
        <span class="material-icons">
          play_arrow
        </span>
      </button>
      <button class="mdc-button mdc-button--raised" onclick="pause()">
        <span class="material-icons">
          pause
        </span>
      </button>

      <script>
        function pause() {
          var x = document.getElementById("TM");
          x.style.display = "none";
          webcam.stop();
        }
      </script>

      <button
        class="mdc-button mdc-button--raised"
        onclick="window.location.href = 'Work.html';"
      >
        <span class="material-icons">
          skip_next
        </span>
      </button>

      <button
        class="mdc-button mdc-button--raised"
        onclick="window.location.href = 'stats.html';"
      >
        <span class="material-icons">
          bar_chart
        </span>
      </button>

      <footer></footer>

      <br />

      <!-- import the Material javascript file -->
      <script src="components.dll.js"></script>
      <script src="bundle.js"></script>
    </main>
  </div>
</body>
<!--TM-->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
<script type="text/javascript">
  // More API functions here:
  // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/pose

  // the link to your model provided by Teachable Machine export panel
  const URL = "https://teachablemachine.withgoogle.com/models/vxiow7xHt/";
  let model, webcam, ctx, labelContainer, maxPredictions;

  async function init() {
    start();
    startTimer();
    drawExercise();
  }
  async function start() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    // load the model and metadata
    // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
    // Note: the pose library adds a tmPose object to your window (window.tmPose)
    model = await tmPose.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    // Convenience function to setup a webcam
    const size = 200;
    const flip = true; // whether to flip the webcam
    webcam = new tmPose.Webcam(size, size, flip); // width, height, flip
    await webcam.setup(); // request access to the webcam
    await webcam.play();
    window.requestAnimationFrame(loop);

    // append/get elements to the DOM
    const canvas = document.getElementById("canvas");
    canvas.width = size;
    canvas.height = size;
    ctx = canvas.getContext("2d");
    labelContainer = document.getElementById("label-container");
    for (let i = 0; i < maxPredictions; i++) {
      // and class labels
      labelContainer.appendChild(document.createElement("div"));
    }
    var x = document.getElementById("TM");
    x.style.display = "block";
  }

  function startTimer() {
    var durBreak = localStorage.getItem("durBreak") * 60;
    progress(durBreak, durBreak, $("#progressBar"));
  }

  async function loop(timestamp) {
    webcam.update(); // update the webcam frame
    await predict();
    window.requestAnimationFrame(loop);
  }

  async function predict() {
    // Prediction #1: run input through posenet
    // estimatePose can take in an image, video or canvas html element
    const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
    // Prediction 2: run input through teachable machine classification model
    const prediction = await model.predict(posenetOutput);

    for (let i = 0; i < maxPredictions; i++) {
      const classPrediction =
        prediction[i].className + ": " + prediction[i].probability.toFixed(2);
      labelContainer.childNodes[i].innerHTML = classPrediction;
    }

    // finally draw the poses
    drawPose(pose);
  }

  function drawPose(pose) {
    if (webcam.canvas) {
      ctx.drawImage(webcam.canvas, 0, 0);
      // draw the keypoints and skeleton
      if (pose) {
        const minPartConfidence = 0.5;
        tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
        tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
      }
    }
  }
</script>
